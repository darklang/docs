<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-contributing/general-concepts" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">General concepts | Dark Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.darklang.com/img/favicon.ico"><meta data-rh="true" name="twitter:image" content="https://docs.darklang.com/img/favicon.ico"><meta data-rh="true" property="og:url" content="https://docs.darklang.com/contributing/general-concepts"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="General concepts | Dark Documentation"><meta data-rh="true" name="description" content="Editor vs Production (how code runs)"><meta data-rh="true" property="og:description" content="Editor vs Production (how code runs)"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.darklang.com/contributing/general-concepts"><link data-rh="true" rel="alternate" href="https://docs.darklang.com/contributing/general-concepts" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.darklang.com/contributing/general-concepts" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QFOZBC0VVL-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-159199190-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>


<link rel="search" type="application/opensearchdescription+xml" title="Dark Documentation" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.c0fb250a.css">
<script src="/assets/js/runtime~main.71163a03.js" defer="defer"></script>
<script src="/assets/js/main.3cb55116.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://darklang.com" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/favicon.ico" alt="Darklang logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/favicon.ico" alt="Darklang logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Darklang</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/introduction">Classic</a><a class="navbar__item navbar__link" href="/next/introduction">Next</a><a class="navbar__item navbar__link" href="/contributing/getting-started">Contributing</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/contributing/getting-started">Your First Contribution</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/contributing/next-contribution">Your Next Contributions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/contributing/fsharp-for-dark-developers">Working in the Dark repo</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contributing/fsharp-for-dark-developers">F# for Darklang developers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/contributing/general-concepts">General concepts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contributing/tour-of-backend">A tour of the Backend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contributing/repo-layout">Repository directory structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contributing/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contributing/debugging">Debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contributing/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contributing/making-a-pull-request">Making a Pull Request</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/contributing/new-release-checklist">New-Release Checklist</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><span class="breadcrumbs__link">Working in the Dark repo</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">General concepts</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>General concepts</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="editor-vs-production-how-code-runs">Editor vs Production (how code runs)<a href="#editor-vs-production-how-code-runs" class="hash-link" aria-label="Direct link to Editor vs Production (how code runs)" title="Direct link to Editor vs Production (how code runs)">​</a></h2>
<p>Code runs in two places in Darklang: in the Editor, and in Production. In
production, we have a Kubernetes cluster of interpreters with HTTP servers which
are connected to a database, connected to the internet via Google Cloud
infrastructure, that run Darklang programs.</p>
<p>When requests are made in production we save their inputs and intermediate
values (combined, these form a &quot;trace&quot;, discussed below). Those are sent to the
client.</p>
<p>The Darklang interpreter is also compiled to WebAssembly and is available in the
browser in the client. The traces are sent to the WASM-compiled interpreter,
which uses their results to fill in for functions which can&#x27;t be run on the
client (such as DB functions).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="traces--live-values">Traces &amp; Live values<a href="#traces--live-values" class="hash-link" aria-label="Direct link to Traces &amp; Live values" title="Direct link to Traces &amp; Live values">​</a></h2>
<p>When a request is made to a production server, the inputs (typically a HTTP
request) are saved. We also save intermediate results of functions which are
called during the request. Together, these comprise a trace. Traces are shown in
the editor and users can choose between them.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="toplevels">Toplevels<a href="#toplevels" class="hash-link" aria-label="Direct link to Toplevels" title="Direct link to Toplevels">​</a></h2>
<p>&quot;Toplevel&quot; is the generic name for a part of a Darklang program, either a
handler (whether a HTTP handler, a Cron or a worker), a function, a type, or a
database.</p>
<p>Structural toplevels are toplevels which are part of the structure of your
program: handlers and DBs. These live on the canvas.</p>
<p>Other toplevels are non-structural, and they don&#x27;t live on the canvas or really
anywhere. We have started to affectionately refer to the display for these as
the &quot;function space&quot;. (There is a design for what should happen here, but we
have not done it yet).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-path-of-an-edit">The path of an edit<a href="#the-path-of-an-edit" class="hash-link" aria-label="Direct link to The path of an edit" title="Direct link to The path of an edit">​</a></h2>
<p>Most characters that you type are immediately saved in our production database
(in, according to our claim, 50ms). Edits are either made to program code, which
is part of the &quot;Fluid&quot; editing system, or to handlers, databases, function
parameters, or similar metadata, which is part of the &quot;Forms&quot; editing system
(originally, all edits were of the &quot;forms&quot; variety - the name was added post-hoc
to differentiate it from &quot;fluid&quot;).</p>
<p>For Fluid, this is the journey:</p>
<ul>
<li>the event processed by <code>FluidKeyboard.res</code>, creating a <code>FluidMsg</code></li>
<li><code>Fluid.res</code> recognized the <code>FluidMsg</code>, calling <code>updateKey</code></li>
<li><code>updateKey</code> looks at the current caret position, and at the &quot;tokens&quot; before
and after the caret, to figure out what&#x27;s happening</li>
<li><code>updateKey</code> makes a transformation based on whatever it decided</li>
<li>the AST for that code is transformed</li>
<li><code>FluidAutocomplete</code> may be regenerated, if necessary</li>
<li>the browser&#x27;s animation event fires, causing a re-render. The AST is
&quot;tokenized&quot;, essentially pretty-printing it as HTML, which then renders</li>
<li>an API call is made to send the change to the server (detailed below)</li>
</ul>
<p>For forms, the journey is similar:</p>
<ul>
<li>the event is processed by <code>KeyPress.res</code></li>
<li>the contents of <code>m.complete.value</code> are updated (this is where the value in the
forms box is stored)</li>
<li>the <code>Autocomplete</code> values are regenerated</li>
<li>after pressing enter, or clicking away, the change is made</li>
<li>an API call is made to send the change to the server (detailed below)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sending-the-change-to-the-server">Sending the change to the server<a href="#sending-the-change-to-the-server" class="hash-link" aria-label="Direct link to Sending the change to the server" title="Direct link to Sending the change to the server">​</a></h3>
<p>When a change is made, typically an <code>AddOp</code> <code>modification</code> is made. That
<code>modification</code> is returned by many of the functions that edit programs, and it&#x27;s
processed in <code>Main.res</code>. This passes into <code>API.res</code>, where it serializes the
<code>Op</code> change into a JSON via encoders (see <code>Enconders.res</code> and <code>Decoders.res</code>).</p>
<p>The change is accepted by <code>ApiServer.fs</code> in the backend, where it is decoded,
applied to the program, and then saved into the database. Saving the program
involves a special binary serialization format, in <code>BinarySerialization.fs</code>.</p>
<p>After being saved, it is sent to Pusher.com, the websockets vendor we use. This
is sent to other clients which then update their programs. It is also sent to
the original editor, who ignores it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="asts">ASTs<a href="#asts" class="hash-link" aria-label="Direct link to ASTs" title="Direct link to ASTs">​</a></h2>
<p>An &quot;AST&quot; is an &quot;Abstract syntax tree&quot;. The simple explanation is that it&#x27;s a set
of &quot;classes&quot; and &quot;objects&quot; representing programs. (Abstract syntax tree means
the programs representation (the &quot;syntax tree&quot;) without the annoying syntactic
details like commas and semi-colons (hence &quot;abstract&quot;)).</p>
<p>In Darklang, it&#x27;s defined in <code>FluidExpression.res</code>, and at time of writing looks
like this:</p>
<div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">type sendToRail =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | Rail</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | NoRail</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type expr  =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EInteger of id * string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EBool of id * bool</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EString of id * string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EFloat of id * string * string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | ENull of id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EBlank of id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | ELet of id * string * expr * expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EIf of id * expr * expr * expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EBinOp of id * string * expr * expr * sendToRail</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | ELambda of id * (id * string) list * expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EFieldAccess of id * expr * string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EVariable of id * string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EFnCall of id * string * expr list * sendToRail</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EPartial of id * string * expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | ERightPartial of id * string * expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | ELeftPartial of id * string * expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EList of id * expr list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | ERecord of id * (string * expr) list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EPipe of id * expr list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EConstructor of id * string * expr list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EMatch of id * expr * (matchPattern * expr) list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EPipeTarget of id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | EFeatureFlag of id * string * expr * expr * expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | ETuple of id * expr * expr * expr list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type matchPattern =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | MPNull of id * id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | MPBlank of id * id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | MPBool of id * id * bool</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | MPVariable of id * id * string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | MPInteger of id * id * string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | MPFloat of id * id * string * string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | MPString of id * id * string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | MPConstructor of id * id * string * matchPattern list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | MPTuple of id * id * matchPattern * matchPattern * matchPattern list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>These definitions are in F# (we have a
<a href="/contributing/fsharp-for-dark-developers">guide to F# for Darklang developers</a>). Briefly,
this means that an <code>expr</code> is an integer (which is made up of an id and a string)
or a bool (made up of an id and a string), or a <code>match</code> (which is an id, an
expression to match on, and a list of patterns and expressions), etc</p>
<p>This definition is slightly simplified, but it&#x27;s close. There&#x27;s definitions for
literals like ints and strings, for definitions like <code>let</code>s, for function calls
with <code>EBinOp</code> and <code>EFnCall</code>, and also for various editor-specific intermediate
states like <code>EPartial</code> and <code>ERightPartial</code>.</p>
<p>Each expression has an <code>id</code> that is used to uniquely refer to the expression.
This is used when editing programs, and to relate live values from the analysis
engine to the display in the editor. If an ID is duplicated by accident, the
editor will act weirdly, but the program will work fine.</p>
<p><code>FluidMatchPattern.res</code> and <code>FluidExpression.res</code> also contain functions for
changing match patterns and expressions easily, either by changing the by ID or
by traversing across the entire structure. Traversing the structure is generally
pretty fast.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/darklang/docs/edit/main/docs-classic/contributing/general-concepts.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/contributing/fsharp-for-dark-developers"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">F# for Darklang developers</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/contributing/tour-of-backend"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">A tour of the Backend</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#editor-vs-production-how-code-runs" class="table-of-contents__link toc-highlight">Editor vs Production (how code runs)</a></li><li><a href="#traces--live-values" class="table-of-contents__link toc-highlight">Traces &amp; Live values</a></li><li><a href="#toplevels" class="table-of-contents__link toc-highlight">Toplevels</a></li><li><a href="#the-path-of-an-edit" class="table-of-contents__link toc-highlight">The path of an edit</a><ul><li><a href="#sending-the-change-to-the-server" class="table-of-contents__link toc-highlight">Sending the change to the server</a></li></ul></li><li><a href="#asts" class="table-of-contents__link toc-highlight">ASTs</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learning</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://darklang.com/launch/demo-video" target="_blank" rel="noopener noreferrer" class="footer__link-item">Demo Video</a></li><li class="footer__item"><a href="https://youtube.com/c/Darklang/videos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Tutorial Videos</a></li><li class="footer__item"><a href="https://darklang.com/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/tutorials/first-dark-application">Tutorial</a></li><li class="footer__item"><a class="footer__link-item" href="/category/walk-throughs">Walk-throughs</a></li></ul></div><div class="col footer__col"><div class="footer__title">About</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://darklang.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Company</a></li><li class="footer__item"><a href="https://blog.darklang.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://darklang.com/discord-invite" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Discord</a></li><li class="footer__item"><a href="https://github.com/darklang/dark" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dark Repo</a></li><li class="footer__item"><a href="https://github.com/darklang/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docs Repo</a></li><li class="footer__item"><a class="footer__link-item" href="/contributing/getting-started">Contributor Docs</a></li><li class="footer__item"><a href="https://darklang.com/code-of-conduct" target="_blank" rel="noopener noreferrer" class="footer__link-item">Code of Conduct</a></li></ul></div><div class="col footer__col"><div class="footer__title">Product</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://darklang.com/login" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sign in</a></li><li class="footer__item"><a href="https://darklang.com/signup" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sign up</a></li><li class="footer__item"><a href="https://darklang.com/desktop-client" target="_blank" rel="noopener noreferrer" class="footer__link-item">Desktop Client</a></li><li class="footer__item"><a href="https://darklang.com/mailing-list" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mailing List</a></li><li class="footer__item"><a class="footer__link-item" href="/changelog">Changelog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Dark Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>