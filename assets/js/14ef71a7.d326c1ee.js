"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8784],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>u});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),p=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=p(a),u=r,h=m["".concat(o,".").concat(u)]||m[u]||c[u]||i;return a?n.createElement(h,l(l({ref:t},d),{},{components:a})):n.createElement(h,l({ref:t},d))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=m;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:r,l[1]=s;for(var p=2;p<i;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},2845:(e,t,a)=>{a.r(t),a.d(t,{frontMatter:()=>s,contentTitle:()=>o,metadata:()=>p,toc:()=>d,default:()=>m});var n=a(87462),r=a(63366),i=(a(67294),a(3905)),l=["components"],s={id:"twilio-app-tutorial",title:"Twilio tutorial",sidebar_label:"Twilio tutorial"},o=void 0,p={unversionedId:"tutorials/twilio-app-tutorial",id:"tutorials/twilio-app-tutorial",isDocsHomePage:!1,title:"Twilio tutorial",description:"Dark allows you to build backends (API endpoints, workers, cron, and data",source:"@site/docs/tutorials/twilio-app-tutorial.md",sourceDirName:"tutorials",slug:"/tutorials/twilio-app-tutorial",permalink:"/tutorials/twilio-app-tutorial",editUrl:"https://github.com/darklang/docs/edit/main/docs/tutorials/twilio-app-tutorial.md",tags:[],version:"current",frontMatter:{id:"twilio-app-tutorial",title:"Twilio tutorial",sidebar_label:"Twilio tutorial"},sidebar:"Tutorials",previous:{title:"React SPA tutorial",permalink:"/tutorials/react-spa-tutorial"},next:{title:"Clean Error Messages with the Error Rail",permalink:"/tutorials/error-rail-http-tutorial"}},d=[{value:"Daily Text Reminder App",id:"daily-text-reminder-app",children:[{value:"Twilio Credentials",id:"twilio-credentials",children:[],level:3},{value:"Sending a Message",id:"sending-a-message",children:[],level:3},{value:"Receiving Responses",id:"receiving-responses",children:[],level:3},{value:"Processing &amp; Storing Responses",id:"processing--storing-responses",children:[],level:3},{value:"Sign up &amp; Quit",id:"sign-up--quit",children:[],level:3},{value:"Water Tracking",id:"water-tracking",children:[],level:3},{value:"Catch-all Case",id:"catch-all-case",children:[],level:3},{value:"Sending Reminder Messages Once A Day",id:"sending-reminder-messages-once-a-day",children:[],level:3},{value:"Additional Topics (for Fun!)",id:"additional-topics-for-fun",children:[{value:"Cron at Time of Day",id:"cron-at-time-of-day",children:[],level:4},{value:"Seeing/Displaying Responses",id:"seeingdisplaying-responses",children:[],level:4}],level:3}],level:2}],c={toc:d};function m(e){var t=e.components,s=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,n.Z)({},c,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Dark allows you to build backends (API endpoints, workers, cron, and data\nstorage) by writing only your business logic, using production traces."),(0,i.kt)("p",null,"You can access you canvas at darklang.com/a/USERNAME (or USERNAME-CANVASNAME).\nFor this project we recommend darklang.com/a/USERNAME-twilioreminder."),(0,i.kt)("p",null,"We recommend building a hello world API endpoint to get a feel for Dark, as\nfollows:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/image2.gif",src:a(89479).Z})),(0,i.kt)("p",null,"All the major handlers work the same way, but the key for many requests is\nworking directly with incoming data."),(0,i.kt)("h2",{id:"daily-text-reminder-app"},"Daily Text Reminder App"),(0,i.kt)("p",null,"We\u2019re building this app:\n",(0,i.kt)("a",{parentName:"p",href:"https://sample-textreminder.builtwithdark.com/"},"https://sample-textreminder.builtwithdark.com"),"\nIt\u2019s an app that will send a text message once per day at a given time to an end\nuser. In this case, we\u2019ll ask the user \u201cdid you drink enough water today?\u201d and\ntrack their response."),(0,i.kt)("p",null,"To try out the app and see your traces in the sample canvas text \u201cstart\u201d to\n+12482653257."),(0,i.kt)("h3",{id:"twilio-credentials"},"Twilio Credentials"),(0,i.kt)("p",null,"To build your own, you\u2019ll need to set up a Twilio account. Your Twilio SID &\nToken are on the Dashboard."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/mage16.png",src:a(28187).Z})),(0,i.kt)("p",null,"You\u2019ll also need to add a phone number from the \u201cmore\u201d menu on the left-hand\nside, then to the phone number section."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/image15.png",src:a(86467).Z})),(0,i.kt)("p",null,"Once you\u2019ve added a phone number, you can configure a webhook:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/image17.png",src:a(6154).Z})),(0,i.kt)("h3",{id:"sending-a-message"},"Sending a Message"),(0,i.kt)("p",null,"Dark has a built in ",(0,i.kt)("inlineCode",{parentName:"p"},"Twilio::sendText")," function. We can call it in a REPL with\nour own number to verify our webhook."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/mage4.png",src:a(99461).Z})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-textreminder#handler=1108947374"},"https://darklang.com/a/sample-textreminder#handler=1108947374")),(0,i.kt)("h3",{id:"receiving-responses"},"Receiving Responses"),(0,i.kt)("p",null,"After we receive a response, we\u2019ll see a 404 in the side bar section for our\nwebhook, which we can create by hitting the \u201c+\u201d button."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/mage3.png",src:a(84992).Z})),(0,i.kt)("p",null,"Once the handler is created, we\u2019re able to see the full incoming trace."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/image19.png",src:a(46698).Z})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-textreminder#handler=1004312353"},"https://darklang.com/a/sample-textreminder#handler=1004312353")),(0,i.kt)("h3",{id:"processing--storing-responses"},"Processing & Storing Responses"),(0,i.kt)("p",null,"In Dark, you can work directly with incoming traces. More on this in\n",(0,i.kt)("a",{parentName:"p",href:"/trace-driven-development"},"Trace Driven Development"),". For this handler, we\ncan parse out the things we care about: a user deciding to start/stop using our\nservice, or telling us if they drank enough water or not."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/image7.png",src:a(98238).Z})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-textreminder#handler=1004312353"},"https://darklang.com/a/sample-textreminder#handler=1004312353")),(0,i.kt)("p",null,"At each expression, we can see what the expression evaluates to for a given\ntrace. Here, we see the From number. In this case we also do some cleaning on\nthe response in case the user had a capital letter or an extraneous space."),(0,i.kt)("p",null,"For processing the various responses, we\u2019ll use a match statement. More on\n",(0,i.kt)("a",{parentName:"p",href:"/functional-aspects#match"},"Match")," is available, but the tutorial example has\nenough context to understand how it works for this case."),(0,i.kt)("h3",{id:"sign-up--quit"},"Sign up & Quit"),(0,i.kt)("p",null,"Now, let\u2019s do the \u201cstart\u201d case. This allows us to give the user our Twilio\nnumber, and have them text \u201cstart\u201d to begin receiving a daily reminder. We\u2019ll\nneed a data store to keep track of our users, which can be created from the\nomnibox (",(0,i.kt)("inlineCode",{parentName:"p"},"Cmd/Ctrl-k"),") or the side bar."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/image1.png",src:a(29387).Z})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-textreminder#db=973891964"},"https://darklang.com/a/sample-textreminder#db=973891964")),(0,i.kt)("p",null,"Then, we can write the logic to add users to the datastore when they text\n\u201cstart.\u201d In this case we use the user\u2019s phone number as the unique key."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/image9.png",src:a(6802).Z})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-textreminder#handler=1004312353"},"https://darklang.com/a/sample-textreminder#handler=1004312353")),(0,i.kt)("p",null,"The stop case is very similar, but removes the user from the datastore."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/image13.png",src:a(49625).Z})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-textreminder#handler=1004312353"},"https://darklang.com/a/sample-textreminder#handler=1004312353")),(0,i.kt)("p",null,"To test, you can always send a new reply to the text message (or just message\nyour number) and walk through the trace to see the live values at each step."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/image11.png",src:a(82319).Z})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-textreminder#handler=1004312353"},"https://darklang.com/a/sample-textreminder#handler=1004312353")),(0,i.kt)("h3",{id:"water-tracking"},"Water Tracking"),(0,i.kt)("p",null,"Now we\u2019ll want the cases for when the user responds to the daily question of\n\u201cdid you drink enough water today?\u201d"),(0,i.kt)("p",null,"We\u2019ll want another data store so we can track the daily response by user (side\nbar or ",(0,i.kt)("inlineCode",{parentName:"p"},"Cmd/Ctrl-k"),")."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/image12.png",src:a(76341).Z})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-textreminder#db=1164294845"},"https://darklang.com/a/sample-textreminder#db=1164294845")),(0,i.kt)("p",null,"In this case since we do not want to use the phone number as the unique key, we\ngenerate a unique key when storing using the built in ",(0,i.kt)("inlineCode",{parentName:"p"},"DB::generateKey"),"\nfunction:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/image18.png",src:a(51537).Z})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-textreminder#handler=1004312353"},"https://darklang.com/a/sample-textreminder#handler=1004312353")),(0,i.kt)("h3",{id:"catch-all-case"},"Catch-all Case"),(0,i.kt)("p",null,"Finally, we need a case for when we don\u2019t match on one of our earlier responses.\nWe\u2019ll want to send a text back to tell the user about the error. To prevent this\nfrom blocking other actions, we\u2019ll emit to a background worker."),(0,i.kt)("p",null,"Here, we emit the user\u2019s number (user) to a background worker named\nMisunderstood (and see the event as a trace). Once you\u2019ve hit \u201cplay\u201d on the emit\nexpression, you should have a 404 for the worker in the side bar that you can\nhit the + to add. If it does not appear in the sidebar, wait ","~","30s or refresh\nthe browser."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/image14.png",src:a(20561).Z})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-textreminder#handler=331438030"},"https://darklang.com/a/sample-textreminder#handler=331438030")),(0,i.kt)("p",null,"Then we can write the code similar to our earlier REPL to send a message asking\nfor a more clear response:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/image8.png",src:a(15873).Z})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-textreminder#handler=331438030"},"https://darklang.com/a/sample-textreminder#handler=331438030")),(0,i.kt)("h3",{id:"sending-reminder-messages-once-a-day"},"Sending Reminder Messages Once A Day"),(0,i.kt)("p",null,"To send each user a reminder once per day, we\u2019ll want to have a cron set to run\ndaily. In this case we\u2019ll get all the users, then emit to a background worker to\nsend the messages."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/image6.png",src:a(39375).Z})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-textreminder#handler=1621731316"},"https://darklang.com/a/sample-textreminder#handler=1621731316")),(0,i.kt)("p",null,"Much like before, this will add the worker to the 404 section where you can add\nit, with the traces."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/image5.png",src:a(62367).Z})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-textreminder#handler=337743491"},"https://darklang.com/a/sample-textreminder#handler=337743491")),(0,i.kt)("p",null,"The code is identical to the code in our REPL:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twilio/image10.png",src:a(53526).Z})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-textreminder#handler=337743491"},"https://darklang.com/a/sample-textreminder#handler=337743491")),(0,i.kt)("p",null,"This is now a fully functioning application."),(0,i.kt)("p",null,"You could do similar ones for:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"A reminder to stand up once per hour"),(0,i.kt)("li",{parentName:"ul"},"A daily reminder to do a task (fill in a personal CRM, floss)"),(0,i.kt)("li",{parentName:"ul"},"A weekly reminder to take out the trash")),(0,i.kt)("h3",{id:"additional-topics-for-fun"},"Additional Topics (for Fun!)"),(0,i.kt)("h4",{id:"cron-at-time-of-day"},"Cron at Time of Day"),(0,i.kt)("p",null,"If you\u2019d like to set the reminder to occur at a specific time of day, you can\nset this using a datastore. There\u2019s a sample canvas\n",(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-setcrontorunatspecifictime"},"here"),". For this\napplication, add the \u201creminder time\u201d in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Users")," table, and add a case to\nallow users to specify a time (that you would then convert to a Date object)."),(0,i.kt)("h4",{id:"seeingdisplaying-responses"},"Seeing/Displaying Responses"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-textreminder#handler=911581692"},"This API handler shows all checkins for a given user.")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-textreminder#handler=400638438"},"This API handler shows the percentage of \u201cyes\u201d responses for a given user.")))}m.isMDXComponent=!0},29387:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image1-1be90b8958e3c8d4072893edd88952e8.png"},53526:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image10-0d37788d943f1a76c198813b39a331d3.png"},82319:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image11-c75097215b319249379a825ebe063f16.png"},76341:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image12-340a6932dbbca51b61fa7992261361f1.png"},49625:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image13-2158ad6af5eeb286af74e889acf01cce.png"},20561:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image14-c16c481fa7842031451e7bfaefbba4e8.png"},86467:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image15-c2a0f669b73a11de71152f6301207269.png"},28187:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image16-870c8fd992e44373c8b6072494bd0537.png"},6154:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image17-23087026909974644ab74553fbfed156.png"},51537:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image18-cb01a082c7bbe915417871668b3d1454.png"},46698:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image19-f3e14c9b1f2ce9822f768afef5ba70be.png"},89479:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image2-d085d172a7f4085eacdae2344bbc04fc.gif"},84992:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image3-37979c0f4f55e9bbe2e8581e3564e53f.png"},99461:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image4-fecec104ff80faf1e650fce760881a35.png"},62367:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image5-4350b4145b8fb1b3d42572a3df933e2c.png"},39375:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image6-e49c5d1dce9e03f2975c8591ec46bd98.png"},98238:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image7-8b5136700c72975bf92a4428d7452853.png"},15873:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image8-5e15ea053817d580e30021eb9b2b2878.png"},6802:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image9-805d2d060475da82af838b870bdc696c.png"}}]);