"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4504],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var n=a(67294);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t){if(null==e)return{};var a,n,l=function(e,t){if(null==e)return{};var a,n,l={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var i=n.createContext({}),p=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(i.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,l=e.mdxType,s=e.originalType,i=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),d=p(a),m=l,h=d["".concat(i,".").concat(m)]||d[m]||c[m]||s;return a?n.createElement(h,o(o({ref:t},u),{},{components:a})):n.createElement(h,o({ref:t},u))}));function m(e,t){var a=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var s=a.length,o=new Array(s);o[0]=d;var r={};for(var i in t)hasOwnProperty.call(t,i)&&(r[i]=t[i]);r.originalType=e,r.mdxType="string"==typeof e?e:l,o[1]=r;for(var p=2;p<s;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},16379:(e,t,a)=>{a.r(t),a.d(t,{frontMatter:()=>r,contentTitle:()=>i,metadata:()=>p,toc:()=>u,default:()=>d});var n=a(87462),l=a(63366),s=(a(67294),a(3905)),o=["components"],r={id:"static-assets",title:"How to host Static Assets on Dark",sidebar_label:"How to host Static Assets"},i=void 0,p={unversionedId:"how-to/static-assets",id:"how-to/static-assets",title:"How to host Static Assets on Dark",description:"Dark supports hosting your static assets.",source:"@site/docs/how-to/static-assets.md",sourceDirName:"how-to",slug:"/how-to/static-assets",permalink:"/how-to/static-assets",editUrl:"https://github.com/darklang/docs/edit/main/docs/how-to/static-assets.md",tags:[],version:"current",frontMatter:{id:"static-assets",title:"How to host Static Assets on Dark",sidebar_label:"How to host Static Assets"},sidebar:"docs",previous:{title:"How-to Guides",permalink:"/category/how-to"},next:{title:"How to set up a custom domain",permalink:"/how-to/custom-domains"}},u=[{value:"Simple Use Case",id:"simple-use-case",children:[],level:2},{value:"Deploying Assets",id:"deploying-assets",children:[{value:"Installation",id:"installation",children:[],level:3},{value:"Configure your client",id:"configure-your-client",children:[],level:3},{value:"Deploy",id:"deploy",children:[],level:3}],level:2},{value:"Set up your App to Load your Assets",id:"set-up-your-app-to-load-your-assets",children:[],level:2},{value:"Implementing a Fallback in the Case of a 404",id:"implementing-a-fallback-in-the-case-of-a-404",children:[],level:2},{value:"Advanced: Feature Flags and Continuous Delivery",id:"advanced-feature-flags-and-continuous-delivery",children:[],level:2},{value:"Reference",id:"reference",children:[{value:"Functions",id:"functions",children:[],level:3},{value:"Command line reference",id:"command-line-reference",children:[],level:3}],level:2}],c={toc:u};function d(e){var t=e.components,r=(0,l.Z)(e,o);return(0,s.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"Dark supports hosting your static assets."),(0,s.kt)("p",null,"Our static assets service is designed to be simple, easy to understand, as well\nas composable and configurable. As such, a static assets deploy uploads your\nassets to our cloud CDN, and we provide powerful tools in Dark to serve and\nconfigure them."),(0,s.kt)("p",null,"A\n",(0,s.kt)("a",{parentName:"p",href:"https://github.com/marketplace/actions/upload-static-assets-to-dark-canvas"},"GitHub Action"),"\nto automate this process is now available thanks to one of our fantastic\ncommunity members, Greg Brimble!"),(0,s.kt)("h2",{id:"simple-use-case"},"Simple Use Case"),(0,s.kt)("p",null,(0,s.kt)("em",{parentName:"p"},"Note: You can see the finished product at\n",(0,s.kt)("a",{parentName:"em",href:"https://darklang.com/a/sample-static-assets"},"https://darklang.com/a/sample-static-assets"))),(0,s.kt)("p",null,"We have a single page app, written in react. It talks to our API, written in\nDark. Now we\u2019d like to deploy that app so that customers can use it too. This\nalso works in a similar way for Vue applications, with a few caveats called out\nin line."),(0,s.kt)("p",null,"Here\u2019s how we want our app to work:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"we have an API, served from ",(0,s.kt)("inlineCode",{parentName:"li"},"/api/")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"/")," serves our ",(0,s.kt)("inlineCode",{parentName:"li"},"index.html")," page from our assets"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"index.html")," should point to our static assets host to fetch other assets")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"We\u2019ll focus on the last two things we want our app to do in this document.")),(0,s.kt)("p",null,"At a high level, here are the steps:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"deploy the assets using the dark-cli app"),(0,s.kt)("li",{parentName:"ol"},"load the index page"),(0,s.kt)("li",{parentName:"ol"},"configure your react app")),(0,s.kt)("h2",{id:"deploying-assets"},"Deploying Assets"),(0,s.kt)("p",null,"We have a command-line app to allow you to deploy your assets."),(0,s.kt)("h3",{id:"installation"},"Installation"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Go to\n",(0,s.kt)("a",{parentName:"p",href:"https://dark-cli.storage.googleapis.com/index.html"},"https://dark-cli.storage.googleapis.com/index.html"),",\nand download the appropriate binary for macOS, Windows, or Linux.")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"On macOS or Linux,"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"chmod +x dark-cli-apple\n")),(0,s.kt)("p",{parentName:"li"},"or"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"chmod +x dark-cli-linux\n")),(0,s.kt)("p",{parentName:"li"},"to make it executable.")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"To confirm it works, run it with ",(0,s.kt)("inlineCode",{parentName:"p"},"-\u2014help"),":"),(0,s.kt)("p",{parentName:"li"},"macOS:"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"./dark-cli-apple --help\n")),(0,s.kt)("p",{parentName:"li"},"Linux:"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"./dark-cli-linux --help\n")),(0,s.kt)("p",{parentName:"li"},"Windows:"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"./dark-cli.exe --help\n"))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"On some versions of macOS, you may get one of the the following popups:"),(0,s.kt)("p",{parentName:"li"},(0,s.kt)("img",{alt:"Not downloaded from the app store popup",src:a(84004).Z,width:"842",height:"394"})),(0,s.kt)("p",{parentName:"li"},(0,s.kt)("img",{alt:"Developer cannot be verified popup",src:a(14303).Z,width:"850",height:"402"})),(0,s.kt)("p",{parentName:"li"},"to resolve this, press ",(0,s.kt)("inlineCode",{parentName:"p"},"Ok")," or ",(0,s.kt)("inlineCode",{parentName:"p"},"Cancel")," and open\n",(0,s.kt)("inlineCode",{parentName:"p"},"System Preferences -> Security & Privacy -> General"),"."),(0,s.kt)("p",{parentName:"li"},(0,s.kt)("img",{alt:"System Preferences -&gt; Security &amp; Privacy -&gt; General -&gt; Allow Anyway",src:a(4566).Z,width:"1328",height:"1140"})),(0,s.kt)("p",{parentName:"li"},"Press ",(0,s.kt)("inlineCode",{parentName:"p"},"Allow Anyway")," and repeat step 3."))),(0,s.kt)("h3",{id:"configure-your-client"},"Configure your client"),(0,s.kt)("p",null,"At the moment, our CDN does not support the use of absolute URLs in the\ngenerated files. For example, if your CSS file links an image at\n",(0,s.kt)("inlineCode",{parentName:"p"},"/static/myimage.png"),", that file will not load. You need to use relative URLs\ninstead, in this case ",(0,s.kt)("inlineCode",{parentName:"p"},"./myimage.png"),"."),(0,s.kt)("p",null,"Your ",(0,s.kt)("inlineCode",{parentName:"p"},"index.html")," likely loads other assets, such as ",(0,s.kt)("inlineCode",{parentName:"p"},"app.css")," or ",(0,s.kt)("inlineCode",{parentName:"p"},"app.js"),". For\nspeed, you will load these directly from the Dark CDN, not via your Dark\nhandler. As such, we\u2019ll need to make some edits to your assets to ensure they\u2019re\nalways pointing at the CDN for other assets."),(0,s.kt)("p",null,"During the deployment of the assets, our backend replaces the string\n",(0,s.kt)("inlineCode",{parentName:"p"},"DARK_STATIC_ASSETS_BASE_URL")," in all of your assets with the actual URL of this\ndeployment."),(0,s.kt)("p",null,"When not using a framework, prefix asset paths with Dark's magic string, for\nexample:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-html"},'<img src="DARK_STATIC_ASSETS_BASE_URL/logo.svg" />\n')),(0,s.kt)("p",null,"In React, when compiling your react application, you can use ",(0,s.kt)("inlineCode",{parentName:"p"},"PUBLIC_URL"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"PUBLIC_URL=DARK_STATIC_ASSETS_BASE_URL npm run build\n")),(0,s.kt)("p",null,"If using Angular, you can run the following command:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"ng build --prod --deploy-url DARK_STATIC_ASSETS_BASE_URL/\n")),(0,s.kt)("p",null,"If using Vue, you likely want to set ",(0,s.kt)("inlineCode",{parentName:"p"},"PUBLIC_PATH")," instead:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"PUBLIC_PATH=DARK_STATIC_ASSETS_BASE_URL\n")),(0,s.kt)("p",null,"Additionally, Vue assumes relative paths. If you are having an issue with your\nassets, check to make sure that ",(0,s.kt)("inlineCode",{parentName:"p"},"index.html")," has not added leading path notation\n(",(0,s.kt)("inlineCode",{parentName:"p"},"/PUBLIC_PATH"),"). If it has, you can manually remove and redeploy. More on using\nthis for Vue here:"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://github.com/vuejs/vue-cli/tree/dev/docs/config#publicpath"},"vuejs/vue-cli")),(0,s.kt)("h3",{id:"deploy"},"Deploy"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"To deploy, select the directory you want to upload. In this case, we\u2019ll use\nReact\u2019s default directory ",(0,s.kt)("inlineCode",{parentName:"p"},"build"),".")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Run:"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-bash"}," # The single quotes - around mypass help protect against shell escaping and interpolation.\n # If your password contains a single quote or a backslash don't forget to escape it with a \\\n./dark-cli-apple --canvas myusername-mycanvas --password 'mypass' --user myusername build\n")))),(0,s.kt)("p",null,"(If you want to avoid shell escaping issues entirely, we also support putting\nyour creds in ",(0,s.kt)("inlineCode",{parentName:"p"},"~/.netrc"),"; the format for that is documented at\n",(0,s.kt)("a",{parentName:"p",href:"https://ec.haxx.se/usingcurl/usingcurl-netrc"},"https://ec.haxx.se/usingcurl/usingcurl-netrc"),"\nfor machine ",(0,s.kt)("inlineCode",{parentName:"p"},"darklang.com"),")."),(0,s.kt)("p",null,"On success, we\u2019ll show you the deploy hash, a URL, and a long URL. These are\nwhere your static assets now live! You can see your static assets in the Routing\ntable in your canvas:"),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"ticassets/image1.png",src:a(75869).Z,width:"405",height:"113"})),(0,s.kt)("h2",{id:"set-up-your-app-to-load-your-assets"},"Set up your App to Load your Assets"),(0,s.kt)("p",null,"If your SPA framework generates an ",(0,s.kt)("inlineCode",{parentName:"p"},"index.html"),", or you write one yourself, you\ncan load that for the ",(0,s.kt)("inlineCode",{parentName:"p"},"/")," route in Dark."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Add a handler for ",(0,s.kt)("inlineCode",{parentName:"li"},"/")," to load your ",(0,s.kt)("inlineCode",{parentName:"li"},"index.html")," page using\n",(0,s.kt)("inlineCode",{parentName:"li"},'StaticAssets::serveLatest "index.html"'),"."),(0,s.kt)("li",{parentName:"ul"},"If you\u2019re using client-side routing, you can also add a handler serving\n",(0,s.kt)("inlineCode",{parentName:"li"},"index.html")," for ",(0,s.kt)("inlineCode",{parentName:"li"},"/:rest")," which will be a catch-all handler for any URL\n(besides ",(0,s.kt)("inlineCode",{parentName:"li"},"/"),") that doesn\u2019t have another handler defined for it. This will\nallow your users to load your assets from any of your app\u2019s URLs.")),(0,s.kt)("p",null,"You can copy and paste this example from\n",(0,s.kt)("a",{parentName:"p",href:"https://darklang.com/a/sample-static-assets"},"https://darklang.com/a/sample-static-assets"),"."),(0,s.kt)("h2",{id:"implementing-a-fallback-in-the-case-of-a-404"},"Implementing a Fallback in the Case of a 404"),(0,s.kt)("p",null,"If you\u2019re looking to serve a fallback asset, you can use a match statement:"),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"ticassets/image2.png",src:a(87060).Z,width:"928",height:"244"})),(0,s.kt)("h2",{id:"advanced-feature-flags-and-continuous-delivery"},"Advanced: Feature Flags and Continuous Delivery"),(0,s.kt)("p",null,"We\u2019ve shown you how to deploy new assets that appear immediately. However, you\noften want to control the rollout of those assets, perhaps seeing them yourself,\nor only showing them to users who have opted into beta features. As a result, it\nis easy to use Dark Static Assets with feature flags."),(0,s.kt)("p",null,"Instead of calling ",(0,s.kt)("inlineCode",{parentName:"p"},"HttpClient::serveLatest"),", you can call ",(0,s.kt)("inlineCode",{parentName:"p"},"HttpClient::serve"),",\nand use the deploy hash from your command line."),(0,s.kt)("h2",{id:"reference"},"Reference"),(0,s.kt)("h3",{id:"functions"},"Functions"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"urlFor <deployHash : String> <file : String> -> String"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"Returns a URL to a file for the current canvas and the given ",(0,s.kt)("inlineCode",{parentName:"li"},"deployHash"),":"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},'StaticAssets::urlFor "o6vs1aqcbx" "foo.html"')," ->\n",(0,s.kt)("inlineCode",{parentName:"li"},'"https://ismith-staticassets.darksa.com/stgbcg3kez_zb9-wlbtgta563t8/o6vs1aqcbx/foo.html"')))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"urlForLatest <file : String> -> String"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"Returns a URL to a file for the current canvas and the latest deploy:"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},'StaticAssets::urlForLatest "foo.html"')," ->\n",(0,s.kt)("inlineCode",{parentName:"li"},'"https://ismith-staticassets.darksa.com/stgbcg3kez_zb9-wlbtgta563t8/o6vs1aqcbx/foo.html"')))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"fetch <deployHash : String> <file : String> -> String"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"Returns the contents of a file for the current canvas and the given\n",(0,s.kt)("inlineCode",{parentName:"li"},"deployHash"),":"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},'StaticAssets::fetch "o6vs1aqcbx" "foo.html"')," ->\n",(0,s.kt)("inlineCode",{parentName:"li"},'"<html><body>Hello, world!</body></html>"')))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"fetchLatest <file : String> -> String"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"Returns a URL to a file for the current canvas and the latest deploy:"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},'StaticAssets::fetchLatest "foo.html"')," ->\n",(0,s.kt)("inlineCode",{parentName:"li"},'"<html><body>Hello, world!</body></html>"')))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"serve <deployHash : String> <file : String> -> String"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"Returns the contents of a file for the current canvas and the given\n",(0,s.kt)("inlineCode",{parentName:"li"},"deployHash"),":"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},'StaticAssets::serve "o6vs1aqcbx" "foo.html"')," -> responds with the file\n",(0,s.kt)("inlineCode",{parentName:"li"},"foo.html")," and the headers that the static assets CDN provided"))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"serveLatest <file : String> -> String"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"Returns a URL to a file for the current canvas and the latest deploy:"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},'StaticAssets::serveLatest "foo.html"')," -> responds with the file ",(0,s.kt)("inlineCode",{parentName:"li"},"foo.html"),"\nand the headers that the static assets CDN provided")))),(0,s.kt)("h3",{id:"command-line-reference"},"Command line reference"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"./dark-cli-apple\nerror: The following required arguments were not provided:\n  <paths>\n  --canvas <canvas>\n  --password <password>\n  --user <user>\n\nUSAGE:\ndark-cli-apple [FLAGS] <paths> --canvas <canvas> --password <password> --user <user>\n")))}d.isMDXComponent=!0},75869:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image1-e708b4d9886a41df524a6461418504ec.png"},87060:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image2-ebd1ec60f75253503cdfe34b84f07fb4.png"},4566:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/macos-allow-f2da8f4cd07ce38b10610a76c7252db0.png"},84004:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/macos-popup1-ba4ccd3405f2bdb18c30a6946442d4f5.png"},14303:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/macos-popup2-af313e1a00f130745cda7bf4262e33f8.png"}}]);