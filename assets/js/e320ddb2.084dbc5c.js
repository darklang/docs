"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[985],{98703:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>c,frontMatter:()=>i,metadata:()=>d,toc:()=>o});var t=a(74848),s=a(28453);const i={title:"Walk-through: Send and receive texts via Twilio",sidebar_label:"Twilio: send and receive texts"},r=void 0,d={id:"walk-throughs/twilio-app",title:"Walk-through: Send and receive texts via Twilio",description:"Darklang allows you to build backends (API endpoints, workers, cron, and data",source:"@site/docs-classic/walk-throughs/twilio-app.md",sourceDirName:"walk-throughs",slug:"/walk-throughs/twilio-app",permalink:"/walk-throughs/twilio-app",draft:!1,unlisted:!1,editUrl:"https://github.com/darklang/docs/edit/main/docs-classic/walk-throughs/twilio-app.md",tags:[],version:"current",frontMatter:{title:"Walk-through: Send and receive texts via Twilio",sidebar_label:"Twilio: send and receive texts"},sidebar:"docs",previous:{title:"Trello: Create a new card from Slack",permalink:"/walk-throughs/slack-trello"},next:{title:"IFTTT: trigger an event",permalink:"/walk-throughs/ifttt-events"}},l={},o=[{value:"Daily Text Reminder App",id:"daily-text-reminder-app",level:2},{value:"Twilio Credentials",id:"twilio-credentials",level:3},{value:"Sending a Message",id:"sending-a-message",level:3},{value:"Receiving Responses",id:"receiving-responses",level:3},{value:"Processing &amp; Storing Responses",id:"processing--storing-responses",level:3},{value:"Sign up &amp; Quit",id:"sign-up--quit",level:3},{value:"Water Tracking",id:"water-tracking",level:3},{value:"Catch-all Case",id:"catch-all-case",level:3},{value:"Sending Reminder Messages Once A Day",id:"sending-reminder-messages-once-a-day",level:3},{value:"Additional Topics (for Fun!)",id:"additional-topics-for-fun",level:3},{value:"Cron at Time of Day",id:"cron-at-time-of-day",level:4},{value:"Seeing/Displaying Responses",id:"seeingdisplaying-responses",level:4}];function h(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Darklang allows you to build backends (API endpoints, workers, cron, and data\nstorage) by writing only your business logic, using production traces."}),"\n",(0,t.jsx)(n.p,{children:"You can access you canvas at darklang.com/a/USERNAME (or USERNAME-CANVASNAME).\nFor this project we recommend darklang.com/a/USERNAME-twilioreminder."}),"\n",(0,t.jsx)(n.p,{children:"We recommend building a hello world API endpoint to get a feel for Darklang, as\nfollows:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/image2.gif",src:a(60414).A+"",width:"640",height:"336"})}),"\n",(0,t.jsx)(n.p,{children:"All the major handlers work the same way, but the key for many requests is\nworking directly with incoming data."}),"\n",(0,t.jsx)(n.h2,{id:"daily-text-reminder-app",children:"Daily Text Reminder App"}),"\n",(0,t.jsxs)(n.p,{children:["We\u2019re building this app:\n",(0,t.jsx)(n.a,{href:"https://sample-textreminder.builtwithdark.com/",children:"https://sample-textreminder.builtwithdark.com"}),"\nIt\u2019s an app that will send a text message once per day at a given time to an end\nuser. In this case, we\u2019ll ask the user \u201cdid you drink enough water today?\u201d and\ntrack their response."]}),"\n",(0,t.jsx)(n.p,{children:"To try out the app and see your traces in the sample canvas text \u201cstart\u201d to\n+12482653257."}),"\n",(0,t.jsx)(n.h3,{id:"twilio-credentials",children:"Twilio Credentials"}),"\n",(0,t.jsx)(n.p,{children:"To build your own, you\u2019ll need to set up a Twilio account. Your Twilio SID &\nToken are on the Dashboard."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/mage16.png",src:a(72054).A+"",width:"1188",height:"584"})}),"\n",(0,t.jsx)(n.p,{children:"You\u2019ll also need to add a phone number from the \u201cmore\u201d menu on the left-hand\nside, then to the phone number section."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/image15.png",src:a(87469).A+"",width:"678",height:"1172"})}),"\n",(0,t.jsx)(n.p,{children:"Once you\u2019ve added a phone number, you can configure a webhook:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/image17.png",src:a(25855).A+"",width:"1644",height:"570"})}),"\n",(0,t.jsx)(n.h3,{id:"sending-a-message",children:"Sending a Message"}),"\n",(0,t.jsxs)(n.p,{children:["Darklang has a built in ",(0,t.jsx)(n.code,{children:"Twilio::sendText"})," function. We can call it in a REPL\nwith our own number to verify our webhook."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/mage4.png",src:a(39815).A+"",width:"1720",height:"170"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-textreminder#handler=1108947374",children:"https://darklang.com/a/sample-textreminder#handler=1108947374"})}),"\n",(0,t.jsx)(n.h3,{id:"receiving-responses",children:"Receiving Responses"}),"\n",(0,t.jsx)(n.p,{children:"After we receive a response, we\u2019ll see a 404 in the side bar section for our\nwebhook, which we can create by hitting the \u201c+\u201d button."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/mage3.png",src:a(60200).A+"",width:"798",height:"182"})}),"\n",(0,t.jsx)(n.p,{children:"Once the handler is created, we\u2019re able to see the full incoming trace."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/image19.png",src:a(10833).A+"",width:"1452",height:"942"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-textreminder#handler=1004312353",children:"https://darklang.com/a/sample-textreminder#handler=1004312353"})}),"\n",(0,t.jsx)(n.h3,{id:"processing--storing-responses",children:"Processing & Storing Responses"}),"\n",(0,t.jsxs)(n.p,{children:["In Darklang, you can work directly with incoming traces. More on this in\n",(0,t.jsx)(n.a,{href:"/discussion/trace-driven-development",children:"Trace Driven Development"}),". For this\nhandler, we can parse out the things we care about: a user deciding to\nstart/stop using our service, or telling us if they drank enough water or not."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/image7.png",src:a(72780).A+"",width:"1158",height:"222"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-textreminder#handler=1004312353",children:"https://darklang.com/a/sample-textreminder#handler=1004312353"})}),"\n",(0,t.jsx)(n.p,{children:"At each expression, we can see what the expression evaluates to for a given\ntrace. Here, we see the From number. In this case we also do some cleaning on\nthe response in case the user had a capital letter or an extraneous space."}),"\n",(0,t.jsxs)(n.p,{children:["For processing the various responses, we\u2019ll use a match statement. More on\n",(0,t.jsx)(n.a,{href:"/discussion/functional-aspects#match",children:"Match"})," is available, but the tutorial\nexample has enough context to understand how it works for this case."]}),"\n",(0,t.jsx)(n.h3,{id:"sign-up--quit",children:"Sign up & Quit"}),"\n",(0,t.jsxs)(n.p,{children:["Now, let\u2019s do the \u201cstart\u201d case. This allows us to give the user our Twilio\nnumber, and have them text \u201cstart\u201d to begin receiving a daily reminder. We\u2019ll\nneed a data store to keep track of our users, which can be created from the\nomnibox (",(0,t.jsx)(n.code,{children:"Cmd/Ctrl-k"}),") or the side bar."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/image1.png",src:a(32346).A+"",width:"794",height:"306"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-textreminder#db=973891964",children:"https://darklang.com/a/sample-textreminder#db=973891964"})}),"\n",(0,t.jsx)(n.p,{children:"Then, we can write the logic to add users to the datastore when they text\n\u201cstart.\u201d In this case we use the user\u2019s phone number as the unique key."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/image9.png",src:a(55250).A+"",width:"880",height:"442"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-textreminder#handler=1004312353",children:"https://darklang.com/a/sample-textreminder#handler=1004312353"})}),"\n",(0,t.jsx)(n.p,{children:"The stop case is very similar, but removes the user from the datastore."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/image13.png",src:a(79035).A+"",width:"920",height:"472"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-textreminder#handler=1004312353",children:"https://darklang.com/a/sample-textreminder#handler=1004312353"})}),"\n",(0,t.jsx)(n.p,{children:"To test, you can always send a new reply to the text message (or just message\nyour number) and walk through the trace to see the live values at each step."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/image11.png",src:a(22025).A+"",width:"1046",height:"470"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-textreminder#handler=1004312353",children:"https://darklang.com/a/sample-textreminder#handler=1004312353"})}),"\n",(0,t.jsx)(n.h3,{id:"water-tracking",children:"Water Tracking"}),"\n",(0,t.jsx)(n.p,{children:"Now we\u2019ll want the cases for when the user responds to the daily question of\n\u201cdid you drink enough water today?\u201d"}),"\n",(0,t.jsxs)(n.p,{children:["We\u2019ll want another data store so we can track the daily response by user (side\nbar or ",(0,t.jsx)(n.code,{children:"Cmd/Ctrl-k"}),")."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/image12.png",src:a(57490).A+"",width:"858",height:"456"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-textreminder#db=1164294845",children:"https://darklang.com/a/sample-textreminder#db=1164294845"})}),"\n",(0,t.jsxs)(n.p,{children:["In this case since we do not want to use the phone number as the unique key, we\ngenerate a unique key when storing using the built in ",(0,t.jsx)(n.code,{children:"DB::generateKey"}),"\nfunction:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/image18.png",src:a(62440).A+"",width:"888",height:"982"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-textreminder#handler=1004312353",children:"https://darklang.com/a/sample-textreminder#handler=1004312353"})}),"\n",(0,t.jsx)(n.h3,{id:"catch-all-case",children:"Catch-all Case"}),"\n",(0,t.jsx)(n.p,{children:"Finally, we need a case for when we don\u2019t match on one of our earlier responses.\nWe\u2019ll want to send a text back to tell the user about the error. To prevent this\nfrom blocking other actions, we\u2019ll emit to a background worker."}),"\n",(0,t.jsx)(n.p,{children:"Here, we emit the user\u2019s number (user) to a background worker named\nMisunderstood (and see the event as a trace). Once you\u2019ve hit \u201cplay\u201d on the emit\nexpression, you should have a 404 for the worker in the side bar that you can\nhit the + to add. If it does not appear in the sidebar, wait ~30s or refresh\nthe browser."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/image14.png",src:a(24228).A+"",width:"1964",height:"560"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-textreminder#handler=331438030",children:"https://darklang.com/a/sample-textreminder#handler=331438030"})}),"\n",(0,t.jsx)(n.p,{children:"Then we can write the code similar to our earlier REPL to send a message asking\nfor a more clear response:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/image8.png",src:a(76795).A+"",width:"822",height:"414"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-textreminder#handler=331438030",children:"https://darklang.com/a/sample-textreminder#handler=331438030"})}),"\n",(0,t.jsx)(n.h3,{id:"sending-reminder-messages-once-a-day",children:"Sending Reminder Messages Once A Day"}),"\n",(0,t.jsx)(n.p,{children:"To send each user a reminder once per day, we\u2019ll want to have a cron set to run\ndaily. In this case we\u2019ll get all the users, then emit to a background worker to\nsend the messages."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/image6.png",src:a(84405).A+"",width:"856",height:"204"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-textreminder#handler=1621731316",children:"https://darklang.com/a/sample-textreminder#handler=1621731316"})}),"\n",(0,t.jsx)(n.p,{children:"Much like before, this will add the worker to the 404 section where you can add\nit, with the traces."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/image5.png",src:a(64030).A+"",width:"1178",height:"262"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-textreminder#handler=337743491",children:"https://darklang.com/a/sample-textreminder#handler=337743491"})}),"\n",(0,t.jsx)(n.p,{children:"The code is identical to the code in our REPL:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"twilio/image10.png",src:a(97824).A+"",width:"1586",height:"230"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-textreminder#handler=337743491",children:"https://darklang.com/a/sample-textreminder#handler=337743491"})}),"\n",(0,t.jsx)(n.p,{children:"This is now a fully functioning application."}),"\n",(0,t.jsx)(n.p,{children:"You could do similar ones for:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"A reminder to stand up once per hour"}),"\n",(0,t.jsx)(n.li,{children:"A daily reminder to do a task (fill in a personal CRM, floss)"}),"\n",(0,t.jsx)(n.li,{children:"A weekly reminder to take out the trash"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"additional-topics-for-fun",children:"Additional Topics (for Fun!)"}),"\n",(0,t.jsx)(n.h4,{id:"cron-at-time-of-day",children:"Cron at Time of Day"}),"\n",(0,t.jsxs)(n.p,{children:["If you\u2019d like to set the reminder to occur at a specific time of day, you can\nset this using a datastore. There\u2019s a sample canvas\n",(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-setcrontorunatspecifictime",children:"here"}),". For this\napplication, add the \u201creminder time\u201d in the ",(0,t.jsx)(n.code,{children:"Users"})," table, and add a case to\nallow users to specify a time (that you would then convert to a Date object)."]}),"\n",(0,t.jsx)(n.h4,{id:"seeingdisplaying-responses",children:"Seeing/Displaying Responses"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-textreminder#handler=911581692",children:"This API handler shows all checkins for a given user."})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://darklang.com/a/sample-textreminder#handler=400638438",children:"This API handler shows the percentage of \u201cyes\u201d responses for a given user."})})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},32346:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image1-1be90b8958e3c8d4072893edd88952e8.png"},97824:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image10-0d37788d943f1a76c198813b39a331d3.png"},22025:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image11-c75097215b319249379a825ebe063f16.png"},57490:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image12-340a6932dbbca51b61fa7992261361f1.png"},79035:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image13-2158ad6af5eeb286af74e889acf01cce.png"},24228:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image14-c16c481fa7842031451e7bfaefbba4e8.png"},87469:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image15-c2a0f669b73a11de71152f6301207269.png"},72054:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image16-870c8fd992e44373c8b6072494bd0537.png"},25855:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image17-23087026909974644ab74553fbfed156.png"},62440:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image18-cb01a082c7bbe915417871668b3d1454.png"},10833:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image19-f3e14c9b1f2ce9822f768afef5ba70be.png"},60414:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image2-d085d172a7f4085eacdae2344bbc04fc.gif"},60200:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image3-37979c0f4f55e9bbe2e8581e3564e53f.png"},39815:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image4-fecec104ff80faf1e650fce760881a35.png"},64030:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image5-4350b4145b8fb1b3d42572a3df933e2c.png"},84405:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image6-e49c5d1dce9e03f2975c8591ec46bd98.png"},72780:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image7-8b5136700c72975bf92a4428d7452853.png"},76795:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image8-5e15ea053817d580e30021eb9b2b2878.png"},55250:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/image9-805d2d060475da82af838b870bdc696c.png"},28453:(e,n,a)=>{a.d(n,{R:()=>r,x:()=>d});var t=a(96540);const s={},i=t.createContext(s);function r(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);