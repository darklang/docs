<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-changelog/release-2" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Darklang Release 2 | Dark Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.darklang.com/img/favicon.ico"><meta data-rh="true" name="twitter:image" content="https://docs.darklang.com/img/favicon.ico"><meta data-rh="true" property="og:url" content="https://docs.darklang.com/changelog/release-2"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Darklang Release 2 | Dark Documentation"><meta data-rh="true" name="description" content="June 6th, 2022"><meta data-rh="true" property="og:description" content="June 6th, 2022"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.darklang.com/changelog/release-2"><link data-rh="true" rel="alternate" href="https://docs.darklang.com/changelog/release-2" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.darklang.com/changelog/release-2" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QFOZBC0VVL-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Changelog","item":"https://docs.darklang.com/changelog"},{"@type":"ListItem","position":2,"name":"Release 2 - June 6, 2022","item":"https://docs.darklang.com/changelog/release-2"}]}</script><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-159199190-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>



<link rel="search" type="application/opensearchdescription+xml" title="Dark Documentation" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.1a8325ea.css">
<script src="/assets/js/runtime~main.8c957453.js" defer="defer"></script>
<script src="/assets/js/main.029e1b90.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/favicon.ico"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://darklang.com" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/favicon.ico" alt="Darklang logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/favicon.ico" alt="Darklang logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Darklang</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/introduction">Classic</a><a class="navbar__item navbar__link" href="/next/introduction">Next</a><a class="navbar__item navbar__link" href="/contributing/getting-started">Contributing</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/introduction"><span title="Overview of Darklang Classic" class="linkLabel_WmDU">Overview of Darklang Classic</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/category/tutorial"><span title="Tutorial" class="categoryLinkLabel_W154">Tutorial</span></a><button aria-label="Expand sidebar category &#x27;Tutorial&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/category/walk-throughs"><span title="Walk-throughs" class="categoryLinkLabel_W154">Walk-throughs</span></a><button aria-label="Expand sidebar category &#x27;Walk-throughs&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/category/how-to"><span title="How-to Guides" class="categoryLinkLabel_W154">How-to Guides</span></a><button aria-label="Expand sidebar category &#x27;How-to Guides&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/category/discussion"><span title="Discussion" class="categoryLinkLabel_W154">Discussion</span></a><button aria-label="Expand sidebar category &#x27;Discussion&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/changelog"><span title="Changelog" class="categoryLinkLabel_W154">Changelog</span></a><button aria-label="Collapse sidebar category &#x27;Changelog&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/changelog/release-10"><span title="Release 10 - Jan, 2023" class="linkLabel_WmDU">Release 10 - Jan, 2023</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/changelog/release-9"><span title="Release 9 - Dec, 2022" class="linkLabel_WmDU">Release 9 - Dec, 2022</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/changelog/release-8"><span title="Release 8 - Nov, 2022" class="linkLabel_WmDU">Release 8 - Nov, 2022</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/changelog/release-7"><span title="Release 7 - Oct, 2022" class="linkLabel_WmDU">Release 7 - Oct, 2022</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/changelog/release-6"><span title="Release 6 - Sept, 2022" class="linkLabel_WmDU">Release 6 - Sept, 2022</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/changelog/release-5"><span title="Release 5 - Aug, 2022" class="linkLabel_WmDU">Release 5 - Aug, 2022</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/changelog/release-4"><span title="Release 4 - July, 2022" class="linkLabel_WmDU">Release 4 - July, 2022</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/changelog/release-3"><span title="Release 3 - June, 2022" class="linkLabel_WmDU">Release 3 - June, 2022</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/changelog/release-2"><span title="Release 2 - June 6, 2022" class="linkLabel_WmDU">Release 2 - June 6, 2022</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/changelog/release-1"><span title="Release 1" class="linkLabel_WmDU">Release 1</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/category/reference"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a><button aria-label="Expand sidebar category &#x27;Reference&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/changelog"><span>Changelog</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Release 2 - June 6, 2022</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Darklang Release 2</h1></header>
<p>June 6th, 2022</p>
<p><em>See the <a href="https://blog.darklang.com/darklang-release-3/" target="_blank" rel="noopener noreferrer" class="">blog post</a> for further
discussion.</em></p>
<p>Darklang Release 2 is the culmination of 20 months work of rewriting the backend
from OCaml to F#. This was done to give us more productivity by allowing us use
more 3rd party SDKs, to solve operational issues, and to make it easier to
contribute. Our reasons for making the change were discussed at the time:
<a href="https://blog.darklang.com/new-backend-fsharp/" target="_blank" rel="noopener noreferrer" class="">1</a>,
<a href="https://blog.darklang.com/why-dark-didnt-choose-rust/" target="_blank" rel="noopener noreferrer" class="">2</a>,
<a href="https://blog.darklang.com/leaving-ocaml/" target="_blank" rel="noopener noreferrer" class="">3</a>.</p>
<ul>
<li class="">The editor backend was fully migrated by April 2nd.</li>
<li class="">HTTP backends (for builtwithdark.com) were finished converting on May 3rd.</li>
<li class="">The migration to the new queues was fully converted on May 27th.</li>
<li class="">The execution engine in the editor was switched over on June 5th.</li>
</ul>
<p>The change was documented in a series of blog posts:
<a href="https://blog.darklang.com/hows-the-dark-rewrite-going/" target="_blank" rel="noopener noreferrer" class="">1</a>,
<a href="https://blog.darklang.com/changes-the-the-dark-rewrite/" target="_blank" rel="noopener noreferrer" class="">2</a>,
<a href="https://blog.darklang.com/optimizing-tasks-in-fsharp/" target="_blank" rel="noopener noreferrer" class="">3</a>,
<a href="https://blog.darklang.com/benchmarking-fsharp6-tasks/" target="_blank" rel="noopener noreferrer" class="">4</a>,
<a href="https://blog.darklang.com/darklang-year-in-review-2021/" target="_blank" rel="noopener noreferrer" class="">5</a>,
<a href="https://blog.darklang.com/try-out-the-new-darklang-backend/" target="_blank" rel="noopener noreferrer" class="">6</a>, and
<a href="https://blog.darklang.com/backend-rewrite-complete/" target="_blank" rel="noopener noreferrer" class="">7</a>.</p>
<p>Thanks to everyone who contributed, including
<a href="https://github.com/Athinanarof" target="_blank" rel="noopener noreferrer" class="">Araceli S√°nchez</a>,
<a href="https://github.com/levlaz" target="_blank" rel="noopener noreferrer" class="">Lev Lazinskiy</a>,
<a href="https://github.com/mariajdab" target="_blank" rel="noopener noreferrer" class="">Mar√≠a Jos√© D√°vila</a>,
<a href="https://github.com/mjeffryes" target="_blank" rel="noopener noreferrer" class="">Matthew Jeffryes</a>,
<a href="https://github.com/jwalter" target="_blank" rel="noopener noreferrer" class="">jwalter</a>,
<a href="https://github.com/danicampagna" target="_blank" rel="noopener noreferrer" class="">Daniela Campagna</a>,
<a href="https://github.com/sxmanton" target="_blank" rel="noopener noreferrer" class="">Sean Manton</a>, and especially
<a href="https://github.com/stachudotnet" target="_blank" rel="noopener noreferrer" class="">Stachu Korick</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="major-changes">Major changes<a href="#major-changes" class="hash-link" aria-label="Direct link to Major changes" title="Direct link to Major changes" translate="no">‚Äã</a></h2>
<ul>
<li class="">
<p>Darklang&#x27;s implementation is now asynchronous, meaning that your programs will
no longer be stuck behind other users&#x27; programs making HTTP or DB calls. This
was a major source of slow Dark programs experienced by most users.</p>
<p>As well as massively reducing latency for programs written in Dark, the editor
now loads much faster.</p>
<p>We have also switched from dozens of tiny machines to a smaller number of much
more powerful machines. This makes your programs run faster on average, even
when accounting for the switch to an asynchronous implementation.</p>
</li>
<li class="">
<p>You can now put a lambda in a variable and pipe into it.</p>
</li>
<li class="">
<p>Most error messages are improved, especially for bad input.</p>
</li>
<li class="">
<p>The queues have been rewritten and should not longer suffer from the old
sources of occasional downtime and slow-down.</p>
</li>
<li class="">
<p>During a deploy of the Dark service, cron jobs no longer run the risk of
running twice.</p>
</li>
<li class="">
<p>There is now a <a href="https://status.darklang.com" target="_blank" rel="noopener noreferrer" class="">Status page</a>.</p>
</li>
<li class="">
<p>Dark&#x27;s internal firewalls have been significantly improved</p>
</li>
<li class="">
<p>Several bottlenecks to outbound HTTP requests have been identified and removed</p>
</li>
<li class="">
<p><code>String::length</code> is now <code>O(1)</code> instead of <code>O(N)</code></p>
</li>
<li class="">
<p>JSON output is now significantly faster</p>
</li>
<li class="">
<p>When reading strings from a user, the string is only passed over once.</p>
</li>
<li class="">
<p>Traces are now stored in the background, after a request has completed,
greatly reducing response time on HTTP requests to Dark programs.</p>
</li>
<li class="">
<p>Dark has moved to more powerful cloud machines, going from Google&#x27; Cloud&#x27;s
deprecated N1 machines to extremely powerful T2D machines (2.3x faster)</p>
</li>
<li class="">
<p>The rewrite also addressed some underlying issues that will come out in new
features soon, including a better type system, support for characters and
tuples, fixes for poor behavior in Date and String functions, and more. These
issues are tracked in our new
<a href="https://github.com/darklang/dark/projects/1#column-15173588" target="_blank" rel="noopener noreferrer" class="">project tracker</a>.</p>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="error-messages">Error messages<a href="#error-messages" class="hash-link" aria-label="Direct link to Error messages" title="Direct link to Error messages" translate="no">‚Äã</a></h3>
<p>All error messages have been renovated, attempting to make them more consistent
and to reuse error message machinery. As a result, a majority of Dark error
messages have changed. If you were relying on the explicit format of a Dark
language or StdLib error message, expect that it will be different.</p>
<p>If you do any error handling which relies specifically on the text of an error
message coming from Dark, we recommend you no longer do that, and just use the
presence of the error instead of the text.</p>
<p>There are two places in Dark which use string error messages:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="resulterrors"><code>Result.Error</code>s<a href="#resulterrors" class="hash-link" aria-label="Direct link to resulterrors" title="Direct link to resulterrors" translate="no">‚Äã</a></h4>
<p>The <code>Error</code> enum (referred to as <code>Result.Error</code> below for clarity), will contain
a string error in most cases, which you might be using directly or indirectly.</p>
<p>You might be accessing <code>Result.Error</code>s and their text contents directly using
the <code>match</code> statement.</p>
<p>You might also be accessing their text contents indirectly, using <code>toString</code>, or
other stringifying functions, such as <code>toString</code>, <code>JSON::</code> functions and
<code>HTTPClient::</code> functions. This is only true if you taken the function returning
the <code>Result.Error</code> off the error rail. This text may also make it to your
web/mobile clients or API consumers.</p>
<p><code>Result.Error</code>s returned via a HTTP handler are not presented to the user, so
text cannot leak that way.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="runtime-errors">Runtime errors<a href="#runtime-errors" class="hash-link" aria-label="Direct link to Runtime errors" title="Direct link to Runtime errors" translate="no">‚Äã</a></h4>
<p>Runtime errors (including type errors) are not accessible via Dark programs, and
will always terminate the Dark program when they are accessed. As a result, the
text of any runtime error should not be accessible to your programs or your
users.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="minor-improvements-and-fixes">Minor improvements and fixes<a href="#minor-improvements-and-fixes" class="hash-link" aria-label="Direct link to Minor improvements and fixes" title="Direct link to Minor improvements and fixes" translate="no">‚Äã</a></h2>
<ul>
<li class="">
<p>Dark used to return the <code>Access-Control-Allow-Origin</code> header in lower-case, it
is now returned in mixed case.</p>
</li>
<li class="">
<p>When making a web request to your Dark application, if you did not specific a
<code>user-agent</code> header, Dark used to add a <code>user-agent</code> header of
<code>ocaml-cohttp/1.2.0</code>. We no longer add this header.</p>
</li>
<li class="">
<p>When making a web request to your Dark application with a <code>content-type</code>
header of <code>text/ping</code>, Dark used to ignore the code and immediately return a
response of status code 418. It now processes the request instead.</p>
</li>
<li class="">
<p><code>HttpClient::*</code> functions called with usernames and passwords in the URL can
now support arbitrary UTF-8 (in the past, Unicode was not supported.)</p>
</li>
<li class="">
<p><code>X509::pemCertificatePublicKeys</code> used to only work for RSA keys. It now also
supports DSA and ECDSA keys. The old version would read ECDSA keys and return
an incorrect answer - it now returns a correct answer.</p>
</li>
<li class="">
<p><code>String::split</code> would fail if the 2nd argument was <code>&quot;&quot;</code> and the first argument
was a complex Unicode character, such as <code>String::split &quot;üë®‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë®üë©‚Äçüë©‚Äçüëß‚Äçüë¶üè≥Ô∏è‚Äç‚ößÔ∏è‚ÄçÔ∏èüáµüá∑&quot; &quot;&quot;</code>. This
is now split correctly.</p>
</li>
<li class="">
<p><code>String.trim</code>, <code>String::trimEnd</code> and <code>String::trimStart</code> worked incorrectly in
some Unicode situations, they now work correctly.</p>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="breaking-changes">Breaking changes<a href="#breaking-changes" class="hash-link" aria-label="Direct link to Breaking changes" title="Direct link to Breaking changes" translate="no">‚Äã</a></h2>
<p>These breaking changes were documented and announced many months in advance of
switching over to the new version of Darklang. We also very careful deployed the
new code, watching for suspicious changes in any Dark programs that were
running. In the rare case where something went awry, we contacted the users and
worked with them to ensure a seamless transition.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="string-casing">String casing<a href="#string-casing" class="hash-link" aria-label="Direct link to String casing" title="Direct link to String casing" translate="no">‚Äã</a></h3>
<ul>
<li class=""><code>String::toLowercase_v0</code> and <code>String::toUppercase_v0</code> worked correctly in the
old version of Dark, for all unicode. In the new version, the library we are
using does not correctly handle some case changes, instead keeping the
original character. This happens when the replacement is a different length
than the character being replaced (for example, <code>&quot;÷á&quot;</code> should be <code>&quot;‘µ’í&quot;</code> when
converted to upper case, which the old version did correctly and the new
version does not). We plan to fix this at a later point.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="string-ordering">String ordering<a href="#string-ordering" class="hash-link" aria-label="Direct link to String ordering" title="Direct link to String ordering" translate="no">‚Äã</a></h3>
<ul>
<li class="">
<p>Functions whose output relies on the internal ordering of a <code>Dict</code> may have
different outputs, specifically, the output Lists may be in a different order.
Examples include <code>Dict::keys</code>, <code>Dict::values</code>, and <code>Dict::toList</code> which return
<code>List</code>s of values which are ordered based on the internal ordering in the
original <code>Dict</code>.</p>
</li>
<li class="">
<p>When calling <code>List::uniqueBy</code>, and there is a duplicate, the new version of
Dark may pick a different value for the duplicate. For example:</p>
</li>
</ul>
<div class="language-dark codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dark codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">List.uniqueBy_v0 [1;2;3;4] (fun x -&gt; Int.divide_v0 x 2) = [ 1, 3, 4 ] // old Dark</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">List.uniqueBy_v0 [1;2;3;4] (fun x -&gt; Int.divide_v0 x 2) = [ 1, 2, 4 ] // new Dark</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="http-clients">HTTP Clients<a href="#http-clients" class="hash-link" aria-label="Direct link to HTTP Clients" title="Direct link to HTTP Clients" translate="no">‚Äã</a></h3>
<ul>
<li class=""><code>HttpClient::*</code> functions no longer support making requests with arbitrary
<code>Content-Type</code>s. They must now be
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type" target="_blank" rel="noopener noreferrer" class="">valid</a>,
for example <code>&quot;application/json&quot;</code> or <code>&quot;application/json; charset=utf-8&quot;</code>.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="generating-json">Generating JSON<a href="#generating-json" class="hash-link" aria-label="Direct link to Generating JSON" title="Direct link to Generating JSON" translate="no">‚Äã</a></h3>
<p>We have changed how JSON is generated in many cases. All the JSON generated by
Dark is now standards compliant, and uses a different formatting style.</p>
<p>In the old version of Dark, we would generate invalid JSON for the Float values
<code>NaN</code>, <code>Infinity</code> and <code>-Infinity</code>. The old version of Dark generates them as
bare identifiers, while the new version puts them in a string (e.g. <code>NaN</code> vs
<code>&quot;NaN&quot;</code>).</p>
<p>This may occur in any of the places in which we generate JSON, which are:</p>
<ul>
<li class="">when responding to a HTTP request in the HTTP framework</li>
<li class="">when making a request with <code>HttpClient</code> (any version)</li>
<li class="">when calling any of:<!-- -->
<ul>
<li class=""><code>Dict::toJson_v0</code></li>
<li class=""><code>Object::toJson_v1</code> (<em>deprecated</em>)</li>
<li class=""><code>Object::toJson_v0</code> (<em>deprecated</em>)</li>
<li class=""><code>Twilio::sendText_v1</code></li>
<li class=""><code>Twilio::sendText_v0</code> (<em>deprecated</em>)</li>
</ul>
</li>
</ul>
<p>Note that the following <code>JWT</code> functions do not use this new behavior, and should
have the exact same behavior as before, including:</p>
<ul>
<li class=""><code>JWT::signAndEncode_v0</code> (<em>deprecated</em>)</li>
<li class=""><code>JWT::signAndEncode_v1</code></li>
<li class=""><code>JWT::signAndEncodeWithHeaders_v0</code> (<em>deprecated</em>)</li>
<li class=""><code>JWT::signAndEncodeWithHeaders_v1</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="parsing-json">Parsing JSON<a href="#parsing-json" class="hash-link" aria-label="Direct link to Parsing JSON" title="Direct link to Parsing JSON" translate="no">‚Äã</a></h3>
<p>When parsing JSON, we no longer accept the following invalid JSON:</p>
<ul>
<li class="">bare field names, such as in <code>{ id : 5 }</code>. You need to quote field names:
<code>{ &quot;id&quot;: 5 }</code></li>
<li class="">newlines and invalid bytes in JSON strings</li>
<li class="">the bare identifiers <code>NaN</code>, <code>Infinity</code> and <code>-Infinity</code> are no longer parsed
into valid floats (note that the old version of Dark might have generated JSON
with these values in it)</li>
</ul>
<p>Dark now also allows parsing 64-bit integers (as opposed to 63-bit integers
before).</p>
<p>Dark parses JSON:</p>
<ul>
<li class="">
<p>when receiving a HTTP request in the HTTP framework</p>
</li>
<li class="">
<p>when receiving a response to a request made with <code>HttpClient</code> (any version)</p>
</li>
<li class="">
<p>when calling any of:</p>
<ul>
<li class=""><code>JSON::parse_v1</code></li>
<li class=""><code>JSON::parse_v0</code> (<em>deprecated</em>)</li>
<li class=""><code>JSON::read_v0</code> (<em>deprecated</em>)</li>
<li class=""><code>JSON::read_v0</code> (<em>deprecated</em>)</li>
</ul>
</li>
</ul>
<p>Note that <code>JWT::verifyAndExtract_v0</code> and <code>JWT::verifyAndExtract_v1</code> are not
affected by this change, as they have been kept deliberately compatible with the
old versions.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="http-stack">HTTP stack<a href="#http-stack" class="hash-link" aria-label="Direct link to HTTP stack" title="Direct link to HTTP stack" translate="no">‚Äã</a></h3>
<p>Dark has switched to using Kestrel, a high-performance HTTP server from .NET,
for its HTTP server. There are some differences between the new Kestrel-based
server and the previous OCaml <code>cohttp</code>-based server:</p>
<p>Large differences:</p>
<ul>
<li class="">
<p>Dark programs can no longer set the HTTP <code>Content-Length</code> header and it will
be set automatically. A <code>Content-Length</code> header will be ignored if provided
via <code>Http::response</code> or similar functions.</p>
</li>
<li class="">
<p>Dark is now less lenient to receiving incorrect <code>Content-Length</code> headers. If
the data sent does not match the expected <code>Content-Length</code>, the HTTP server
will return a 400 Bad Request error. Omitting the <code>Content-Length</code> header is
still OK.</p>
</li>
<li class="">
<p>JSON returned from HTTP requests is now formatted differently, as discussed
above.</p>
</li>
</ul>
<p>Minor differences:</p>
<ul>
<li class="">When making HTTP requests to Dark:<!-- -->
<ul>
<li class="">Clients must send at least 256 bytes every 5 seconds or be timed-out</li>
<li class="">All headers must be sent in first 10 seconds</li>
<li class="">There must be fewer than 100 headers and they must fit in 32KB</li>
<li class="">The maximum size of HTTP requests to Dark is 10MB</li>
</ul>
</li>
<li class="">HTTP responses sent by Dark<!-- -->
<ul>
<li class="">Headers will be returned in a different order</li>
<li class="">Headers are not always lowercase anymore</li>
<li class="">The <code>Date</code> header is now always present</li>
<li class="">The <code>Server</code> header is now <code>darklang</code> and always present</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-changes">Testing changes<a href="#testing-changes" class="hash-link" aria-label="Direct link to Testing changes" title="Direct link to Testing changes" translate="no">‚Äã</a></h2>
<p>We have gone from about 250 backend tests to over 5,000. We now have custom test
frameworks for:</p>
<ul>
<li class="">
<p><a href="https://github.com/darklang/dark/tree/main/backend/testfiles/execution" target="_blank" rel="noopener noreferrer" class="">language and standard library testing</a></p>
</li>
<li class="">
<p><a href="https://github.com/darklang/dark/tree/main/backend/testfiles/httphandler" target="_blank" rel="noopener noreferrer" class="">HTTP server testing</a></p>
</li>
<li class="">
<p><a href="https://github.com/darklang/dark/tree/main/backend/testfiles/httpclient" target="_blank" rel="noopener noreferrer" class="">Testing HTTP clients</a></p>
</li>
<li class="">
<p><a href="https://github.com/darklang/stable-dark/tree/main/backend/tests/FuzzTests" target="_blank" rel="noopener noreferrer" class="">Fuzz testing</a></p>
</li>
<li class="">
<p><a href="https://github.com/darklang/stable-dark/tree/main/integration-tests" target="_blank" rel="noopener noreferrer" class="">Integration tests</a>
were ported to <a href="https://playwright.dev/" target="_blank" rel="noopener noreferrer" class="">Playwright</a>, from TestCafe. They now
run much faster and are somewhat easier to write.</p>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="operational-changes">Operational changes<a href="#operational-changes" class="hash-link" aria-label="Direct link to Operational changes" title="Direct link to Operational changes" translate="no">‚Äã</a></h2>
<p>Behind the scenes, Dark has greatly improved its operations.</p>
<ul>
<li class="">
<p>Switched to massively more powerful servers (requests now get 2 CPUs of a
<a href="https://cloud.google.com/blog/products/compute/compute-engine-tau-t2d-vms-now-available-for-scale-out-workloads" target="_blank" rel="noopener noreferrer" class="">Google Cloud T2D</a>,
vs 0.1 CPUs of a n1d -- T2Ds are about 2.3x more powerful than N1Ds)</p>
</li>
<li class="">
<p>Separated the servers used by the Darklang editor from the ones running
production applications.</p>
</li>
<li class="">
<p>Massively increased use of <a href="https://honeycomb.io" target="_blank" rel="noopener noreferrer" class="">observability</a> and error
tracking to catch errors and customer issues</p>
</li>
<li class="">
<p>Moved queues from running in the database (often taking over 50% of the CPU,
to relying on our cloud vendor (Google PubSub). Also greatly increased
reliability of the queues.</p>
</li>
<li class="">
<p>Nodes are now autoscaled, leading to significant cost savings.</p>
</li>
<li class="">
<p>Updated to latest version of Kubernetes, <code>cert-manager</code> (which powers our
<a href="https://docs.darklang.com/how-to/custom-domains" target="_blank" rel="noopener noreferrer" class="">custom domains</a> feature),
nginx, and other tools that we use.</p>
</li>
<li class="">
<p>Added internal <a href="https://launchdarkly.com" target="_blank" rel="noopener noreferrer" class="">feature flagging</a> to give us more
control over how our infrastructure runs in production</p>
</li>
<li class="">
<p>Significantly increased use of Kubernetes&#x27; security features, in particular
internal firewalls.</p>
</li>
<li class="">
<p>Standardized our production deployment process using a tool we wrote called
<a href="https://github.com/darklang/dark/blob/8082df91676de2f26a0661bf20827a60976bb3c0/scripts/deployment/shipit" target="_blank" rel="noopener noreferrer" class="">shipit</a></p>
</li>
<li class="">
<p>Removed nginx from our builtwithdark.com backends</p>
</li>
<li class="">
<p>Move migrations out from startup code</p>
</li>
<li class="">
<p>All certs except darksa.com and darkstaticassets.com are now managed
automatically</p>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="documentation-changes">Documentation changes<a href="#documentation-changes" class="hash-link" aria-label="Direct link to Documentation changes" title="Direct link to Documentation changes" translate="no">‚Äã</a></h2>
<ul>
<li class="">moved docs to docs.darklang.com</li>
<li class=""><a href="https://github.com/darklang/docs/pull/220" target="_blank" rel="noopener noreferrer" class="">refactored docs</a> to use the Divio
documentation system, categorizing all docs into Tutorials, Reference,
How-tos, Walk-throughs and Discussion.</li>
<li class="">fixed all links</li>
<li class="">redo the
<a href="https://docs.darklang.com/discussion/error-handling" target="_blank" rel="noopener noreferrer" class="">Error Rail discussion</a></li>
<li class="">add a discussion of
<a href="https://docs.darklang.com/discussion/queues" target="_blank" rel="noopener noreferrer" class="">how the Queues work</a></li>
<li class="">improved and expanded
<a href="https://docs.darklang.com/reference/keyboard-mapping" target="_blank" rel="noopener noreferrer" class="">keyboard shortcuts docs</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="contributing-changes">Contributing changes<a href="#contributing-changes" class="hash-link" aria-label="Direct link to Contributing changes" title="Direct link to Contributing changes" translate="no">‚Äã</a></h2>
<ul>
<li class="">
<p>Added
<a href="https://github.com/darklang/dark/blob/main/CODING-GUIDE.md" target="_blank" rel="noopener noreferrer" class="">coding guidelines</a></p>
</li>
<li class="">
<p>Added significant documentation, especially READMEs and design decisions,
throughout the <a href="https://github.com/darklang/dark" target="_blank" rel="noopener noreferrer" class="">darklang repo</a></p>
</li>
<li class="">
<p>Moved 99% of project collaboration to our
<a href="https://github.com/darklang/dark" target="_blank" rel="noopener noreferrer" class="">public GitHub</a> and
<a href="https://darklang.com/discord-invite" target="_blank" rel="noopener noreferrer" class="">public community chat</a></p>
</li>
<li class="">
<p>ported our
<a href="https://docs.darklang.com/contributing/rescript-and-fsharp-for-dark-developers" target="_blank" rel="noopener noreferrer" class="">contributor guides</a>
to F#</p>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/darklang/docs/edit/main/docs-classic/changelog/release-2.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/changelog/release-3"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Release 3 - June, 2022</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/changelog/release-1"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Release 1</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#major-changes" class="table-of-contents__link toc-highlight">Major changes</a><ul><li><a href="#error-messages" class="table-of-contents__link toc-highlight">Error messages</a></li></ul></li><li><a href="#minor-improvements-and-fixes" class="table-of-contents__link toc-highlight">Minor improvements and fixes</a></li><li><a href="#breaking-changes" class="table-of-contents__link toc-highlight">Breaking changes</a><ul><li><a href="#string-casing" class="table-of-contents__link toc-highlight">String casing</a></li><li><a href="#string-ordering" class="table-of-contents__link toc-highlight">String ordering</a></li><li><a href="#http-clients" class="table-of-contents__link toc-highlight">HTTP Clients</a></li><li><a href="#generating-json" class="table-of-contents__link toc-highlight">Generating JSON</a></li><li><a href="#parsing-json" class="table-of-contents__link toc-highlight">Parsing JSON</a></li><li><a href="#http-stack" class="table-of-contents__link toc-highlight">HTTP stack</a></li></ul></li><li><a href="#testing-changes" class="table-of-contents__link toc-highlight">Testing changes</a></li><li><a href="#operational-changes" class="table-of-contents__link toc-highlight">Operational changes</a></li><li><a href="#documentation-changes" class="table-of-contents__link toc-highlight">Documentation changes</a></li><li><a href="#contributing-changes" class="table-of-contents__link toc-highlight">Contributing changes</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learning</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://darklang.com/launch/demo-video" target="_blank" rel="noopener noreferrer" class="footer__link-item">Demo Video</a></li><li class="footer__item"><a href="https://youtube.com/c/Darklang/videos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Tutorial Videos</a></li><li class="footer__item"><a href="https://darklang.com/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/tutorials/first-dark-application">Tutorial</a></li><li class="footer__item"><a class="footer__link-item" href="/category/walk-throughs">Walk-throughs</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">About</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://darklang.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Company</a></li><li class="footer__item"><a href="https://blog.darklang.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://darklang.com/discord-invite" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Discord</a></li><li class="footer__item"><a href="https://github.com/darklang/dark" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dark Repo</a></li><li class="footer__item"><a href="https://github.com/darklang/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docs Repo</a></li><li class="footer__item"><a class="footer__link-item" href="/contributing/getting-started">Contributor Docs</a></li><li class="footer__item"><a href="https://darklang.com/code-of-conduct" target="_blank" rel="noopener noreferrer" class="footer__link-item">Code of Conduct</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Product</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://darklang.com/login" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sign in</a></li><li class="footer__item"><a href="https://darklang.com/signup" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sign up</a></li><li class="footer__item"><a href="https://darklang.com/desktop-client" target="_blank" rel="noopener noreferrer" class="footer__link-item">Desktop Client</a></li><li class="footer__item"><a href="https://darklang.com/mailing-list" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mailing List</a></li><li class="footer__item"><a class="footer__link-item" href="/changelog">Changelog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2025 Darklang Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>